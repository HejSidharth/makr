# Agentic Guide for makr CLI

This file helps automated agents work effectively in this repository.
It documents build commands, code style, error handling, and file layout.

## 1. Build, Test, and Lint

### Build
- `npm run build` compiles TypeScript via `tsc`.
- Output is written to `dist/`.

### Dev Run
- `npm run dev` runs `src/index.ts` using `ts-node/esm`.

### Tests
- There is no test runner configured in `package.json`.
- No single-test command exists yet.
- When adding tests, prefer a script like `npm run test -- <pattern>`.

### Lint
- There is no linter configured (no ESLint/Prettier scripts).
- Keep formatting consistent with existing TypeScript style.

## 2. Repository Map (Quick Navigation)

### Root
- `bin/makr.js` CLI entry (loads `dist/index.js`).
- `src/index.ts` Commander root and command registration.
- `src/types/index.ts` Shared TypeScript interfaces.
- `AGENTS.md` Agent rules and repo navigation.
- `README.md` User documentation.

### Commands (`src/commands/`)
- `add.ts` Add a GitHub template.
- `clone.ts` Clone a template (optional fork, optional git history).
- `collection.ts` Manage template collections.
- `init.ts` Initialize config at `~/.config/makr/config.json`.
- `list.ts` List templates (filter tags/collections).
- `new.ts` Project creation wizard.
- `projects.ts` Recent project list (alias: `view`).
- `remove.ts` Remove a template.
- `search.ts` Search templates.

### Libraries (`src/lib/`)
- `config.ts` Config I/O, migrations, project/template helpers.
- `git.ts` `cloneRepo`, `removeGitMetadata`, path helpers.
- `github.ts` GitHub API integration (forking).
- `templates.ts` Tag parsing and template filtering.
- `ui.ts` Output helpers (`success`, `error`, `info`, `warning`).

### Distribution (`dist/`)
- Built JS output from `tsc`.
- Regenerated by `npm run build`.

## 3. Code Style Guidelines

### Imports
- Use ES module imports: `import { x } from 'y'`.
- Use `.js` extensions in import paths when targeting compiled ESM.
- Group imports by module type: external first, then internal.

### Formatting
- Use 2-space indentation.
- Use single quotes for strings.
- End statements with semicolons.
- Keep lines short and readable (wrap long template strings).

### Types
- Define interfaces in `src/types/index.ts`.
- Use explicit types for command options and data models.
- Favor `interface` over `type` for object schemas.

### Naming
- Functions and variables: `camelCase`.
- Types and interfaces: `PascalCase`.
- Constants: `UPPER_SNAKE_CASE` when appropriate.
- Command creators: `createXCommand` naming pattern.

### Error Handling
- Wrap command actions with `try/catch`.
- Use `error()` from `src/lib/ui.ts` and exit with `process.exit(1)`.
- Provide user-friendly failure messages (no raw stack traces).

### Logging / Output
- Use `success`, `info`, `warning`, `error` from `src/lib/ui.ts`.
- Prefer `chalk` for styling in command outputs.
- Keep CLI output concise and aligned with other commands.

### Async Patterns
- Use `async/await` consistently (avoid `then` chains).
- Prefer sequential flows for prompts to keep UX predictable.

## 4. Common Workflows for Agents

### Adding a New Command
1. Create a new file in `src/commands/`.
2. Export `createXCommand()` returning a `Command`.
3. Register it in `src/index.ts`.
4. Document it in `README.md`.

### Updating Config Schema
1. Add types in `src/types/index.ts`.
2. Update defaults and migrations in `src/lib/config.ts`.
3. Update any command logic that reads/writes config.

### Updating UI Output
- Prefer updating `src/lib/ui.ts` if output is shared.
- Keep table formatting consistent with `cli-table3` usage.

## 5. CLI Command Summary

Templates:
- `makr add`, `makr list`, `makr search`, `makr clone`, `makr remove`.

Collections:
- `makr collection add|list|show|include|remove|delete|scaffold`.

Projects:
- `makr new` for creation.
- `makr projects` for recent project list.
- `makr view` is an alias for `makr projects`.

Config:
- `makr init` to set clone path, default branch, GitHub token.

## 6. File Location Shortcuts

- Want command logic? Start in `src/commands/`.
- Want config or data schema? Start in `src/lib/config.ts`.
- Want UI helpers? Use `src/lib/ui.ts`.
- Want template parsing? Use `src/lib/templates.ts`.
- Want type definitions? Use `src/types/index.ts`.

## 7. External Rules

- No `.cursor/rules`, `.cursorrules`, or `.github/copilot-instructions.md` found.
- Follow the conventions already used in this repo.

## 8. Agent Guardrails

- Avoid touching `dist/` manually; regenerate with `npm run build`.
- Do not add new dependencies unless asked.
- Keep changes focused and minimize unrelated refactors.
- Prefer editing existing files rather than creating new ones.

## 9. Notes for Single-Test Runs

- No test framework is installed yet.
- If tests are added later, include a single-test run command in `package.json`.
- Example pattern: `npm run test -- <pattern>`.
